<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CGnDEV - Three.js Sandbox</title>
    <style>
        html, body {
            margin: 0;
            height: 100%;
        }
        #c {
            width: 100%;
            height: 100%;
            display: block;
        }
    </style>
</head>
<body>
    <canvas id = "c"></canvas>    
</body>
<script type="module">
import * as THREE from 'https://cdn.skypack.dev/three@0.137.5';

function main() {
    const canvas = document.querySelector( '#c' );
    const renderer = new THREE.WebGLRenderer( {canvas} );

    const scene = new THREE.Scene();
    scene.background = new THREE.Color( 0x000000 );

    const cameraFov = 40;
    const cameraAspect = 2;
    const cameraNear = 0.1;
    const cameraFar = 1000;
    const camera = new THREE.PerspectiveCamera( cameraFov, cameraAspect, cameraNear, cameraFar );
    camera.position.set( 0, 50, 0 );
    camera.up.set( 0, 0, 1 );
    camera.lookAt( 0, 0, 0 );
    
    {
        const color = 0xFFFFFF;
        const intensity = 3;
        const light = new THREE.PointLight( color, intensity );
        scene.add( light );
    }

    const objects = [];
    const solarSystem = new THREE.Object3D(); // !!!
    scene.add( solarSystem );
    objects.push( solarSystem );

    const radius = 1;
    const widthSegments = 6;
    const heightSegments = 6;
    const sphereGeometry = new THREE.SphereGeometry( radius , widthSegments, heightSegments );

    // Sun
    const sunMaterial = new THREE.MeshPhongMaterial( { emissive: 0xFFFF00 });
    const sunMesh = new THREE.Mesh( sphereGeometry, sunMaterial );
    sunMesh.scale.set( 5, 5, 5 );
    solarSystem.add( sunMesh );
    objects.push( sunMesh );

    // Earth root
    const earthOrbit = new THREE.Object3D();
    earthOrbit.position.x = 10
    solarSystem.add( earthOrbit );
    objects.push( earthOrbit );

    // Earth
    const earthMaterial = new THREE.MeshPhongMaterial( { color: 0x2233FF, emissive: 0x112244 });
    const earthMesh = new THREE.Mesh( sphereGeometry, earthMaterial );
    earthOrbit.add( earthMesh );
    objects.push( earthMesh );


    // Moon root
    const moonOrbit = new THREE.Object3D();
    moonOrbit.position.x = 2;
    earthOrbit.add( moonOrbit );

    // Moon 
    const moonMaterial = new THREE.MeshPhongMaterial( { color: 0x888888, emissive: 0x222222 } );
    const moonMesh = new THREE.Mesh( sphereGeometry, moonMaterial );
    moonMesh.scale.set( 0.5, 0.5, 0.5 );
    moonOrbit.add( moonMesh );
    objects.push( moonMesh );

    // AxeHelper 추가
    objects.forEach( ( node ) => {
        const axes = new THREE.AxesHelper();
        axes.material.depthTest = false;
        axes.renderOrder = 1;
        node.add( axes );
    })

    function resizeRendererToDisplaySize( renderer ) {
        const canvas = renderer.domElement;
        const clientWidth = canvas.clientWidth;
        const clientHeight = canvas.clientHeight;
        const needResize = canvas.width !== clientWidth || canvas.height !== clientHeight;

        if ( needResize ) {
            renderer.setSize( clientWidth, clientHeight, false );
        }
        
        return needResize;
    }   
    
    function render( time ) {
        time *= 0.001;

        if( resizeRendererToDisplaySize( renderer )) {
            const canvas = renderer.domElement;
            camera.aspect = canvas.clientWidth / canvas.clientHeight;
            camera.updateProjectionMatrix();
        }

        objects.forEach( (obj) => {
            obj.rotation.y = time;
        })

        // objects.forEach( (obj, ndx ) => {
        //     const speed = 0.1 + ndx * 0.05;
        //     const rot = time * speed;
        //     obj.rotation.x = rot;
        //     obj.rotation.y = rot;
        // })

        renderer.render( scene, camera );

        requestAnimationFrame( render );
    }

    requestAnimationFrame( render );

}

main();

</script>

</html>

